# Руководство по сборке APK через GitHub Actions

Это руководство поможет вам настроить автоматическую сборку APK файлов прямо из GitHub репозитория без необходимости иметь локальную среду разработки Android.

## Предварительные требования

1. Аккаунт на GitHub
2. Все файлы проекта, загруженные в GitHub репозиторий
3. Права на запуск GitHub Actions в вашем репозитории (обычно доступны для всех аккаунтов)

## Инструкция по настройке

### Шаг 1: Создание репозитория

1. Войдите в свой аккаунт GitHub
2. Создайте новый репозиторий через кнопку "New" на главной странице
3. Выберите подходящее имя (например, "smart-basket") и настройки доступа (публичный или приватный)
4. Нажмите "Create repository"

### Шаг 2: Загрузка файлов

1. Загрузите все файлы проекта в созданный репозиторий
   - Через веб-интерфейс (кнопка "Add file")
   - Или через Git команды, если вы их знаете

2. Особое внимание уделите следующим папкам и файлам:
   - Вся папка `android/`
   - Вся папка `.github/workflows/`
   - Файлы `build-android.sh`, `build-all.sh` и т.д.

### Шаг 3: Запуск сборки

1. Перейдите на вкладку "Actions" в вашем репозитории
2. При первом посещении разрешите запуск workflows
3. Выберите "Android Build" workflow из списка
4. Нажмите кнопку "Run workflow" справа
5. Подтвердите запуск, выбрав нужную ветку (обычно "main")

### Шаг 4: Мониторинг сборки

1. Сборка обычно занимает 10-15 минут
2. Вы можете следить за процессом, нажав на запущенный workflow
3. Успешная сборка будет отмечена зеленой галочкой ✅
4. В случае ошибки, вы увидите красный крестик ❌ и сможете просмотреть логи для выявления проблемы

### Шаг 5: Скачивание APK

1. После успешной сборки перейдите в детали выполненного workflow
2. Прокрутите вниз до раздела "Artifacts"
3. Нажмите на "apk-files" для скачивания ZIP-архива со всеми APK файлами
4. Распакуйте архив и выберите нужный APK:
   - `SmartBasket-arm64-v8a.apk` - для современных устройств (рекомендуется)
   - `SmartBasket-armeabi-v7a.apk` - для старых устройств
   - `SmartBasket-universal.apk` - для любых устройств (больший размер)

## Создание релиза

Чтобы создать официальный релиз с APK файлами:

1. Перейдите в раздел "Releases" на странице репозитория
2. Нажмите "Create a new release"
3. Введите номер версии (например, "v1.0.0") как тег
4. Заполните название и описание релиза
5. Нажмите "Publish release"

После публикации релиза, GitHub Actions автоматически прикрепит к нему все APK файлы.

## Решение распространенных проблем

### Ошибка "Missing download info for actions/upload-artifact@vX"

**Причина**: Используемая версия action не поддерживается в вашем плане GitHub или существуют ограничения на использование определенных actions.

**Решение**: Вы можете попробовать следующие варианты:
1. Используйте самую базовую версию action:
```yaml
- name: Upload APK artifacts
  uses: actions/upload-artifact@v1
  with:
    name: apk-files
    path: apk-output
```

2. Если и это не работает, полностью уберите шаг загрузки артефактов и используйте прямое копирование через командную строку:
```yaml
- name: Prepare artifacts
  run: |
    mkdir -p /tmp/artifacts
    cp -r apk-output/*.apk /tmp/artifacts/
    ls -la /tmp/artifacts
    echo "APK файлы созданы в директории /tmp/artifacts. Скачать их можно через GitHub UI."
```

3. В крайнем случае, полностью упростите workflow, чтобы он только собирал APK, а не пытался загружать артефакты:
```yaml
- name: Build Universal APK
  working-directory: ./android
  run: |
    sed -i "s/abiFilters.*/abiFilters 'armeabi-v7a', 'arm64-v8a', 'x86', 'x86_64'/g" app/build.gradle
    ./gradlew assembleDebug
    echo "APK собран, но из-за ограничений GitHub не может быть загружен как артефакт"
```

### Ошибка "Permission denied" при запуске Gradle

**Причина**: Скрипты сборки не имеют права на выполнение.

**Решение**: Эта проблема должна решаться автоматически через step "Выдача прав на Gradle", но если она возникает, убедитесь, что этот шаг присутствует в workflow:
```yaml
- name: Выдача прав на Gradle
  run: chmod +x ./android/gradlew
```

### Ошибка "could not find React Native core"

**Причина**: Проблема с установкой зависимостей.

**Решение**: Убедитесь, что выполняются все шаги по установке:
```yaml
- name: Install dependencies
  run: npm ci

- name: Install Capacitor CLI
  run: npm install -g @capacitor/cli
```

### Долгое время сборки

**Причина**: Сборка для всех архитектур требует времени.

**Решение**: Если вам нужна только одна архитектура (например, arm64-v8a), вы можете изменить workflow, удалив ненужные шаги сборки других архитектур.

## Примечания

- APK файлы, собранные через GitHub Actions, будут неподписанными (debug-версии)
- Для публикации в Google Play потребуется подписать APK вручную или настроить подписывание в workflow
- Артефакты сборки хранятся 30 дней, после чего автоматически удаляются